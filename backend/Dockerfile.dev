# Development backend â€” hot reload with ts-node / nodemon
# syntax=docker/dockerfile:1
FROM node:20-alpine3.20

WORKDIR /app

ENV NODE_ENV=development \
    PORT=3000 \
    HOST=0.0.0.0

# Native module build tools (required by bcrypt, sharp, etc.)
RUN apk add --no-cache dumb-init python3 make g++

# Install deps before copying source for better layer caching
COPY package*.json ./
RUN npm ci --no-audit --no-fund

# Copy source (overridden by bind-mount in docker-compose.dev.yml)
COPY . .

# Application port + Node.js inspector (shifted to 800x)
EXPOSE 3000 8009

ENTRYPOINT ["dumb-init", "--"]
CMD ["npm", "run", "dev"]
